<div style="display:flex;justify-content:center;align-items:center;padding:1.5rem 0;font-family:inherit;position:relative;">
  <div style="position:relative;max-width:480px;width:100%;">
    <form onsubmit="(function(e){e.preventDefault();var q=document.getElementById('snc-input').value.trim();if(q)window.location.href='https://swissnatcoll.ch/occurrence/search?q='+q.replace(/\s+/g,'+');})(event);return false;" style="display:flex;align-items:center;border:1.5px solid #ccc;border-radius:999px;overflow:hidden;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,0.08);width:100%;">
      <input id="snc-input" name="q" type="text" placeholder="Search species (e.g. Microtus arvalis)" autocomplete="off"
        style="flex:1;border:none;outline:none;padding:0.6rem 1.1rem;font-size:1rem;background:transparent;font-family:inherit;"
        oninput="sncFetch(this.value)"
        onkeydown="sncKey(event)" />
      <button type="submit" title="Search" style="background:none;border:none;cursor:pointer;padding:0.5rem 0.9rem;display:flex;align-items:center;color:#555;">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      </button>
    </form>
    <ul id="snc-suggestions" style="display:none;position:absolute;top:calc(100% + 6px);left:0;right:0;background:#fff;border:1.5px solid #ddd;border-radius:12px;box-shadow:0 4px 16px rgba(0,0,0,0.10);list-style:none;margin:0;padding:0.3rem 0;z-index:9999;max-height:260px;overflow-y:auto;"></ul>
  </div>

  <script>
  (function(){
    var timer = null;
    var active = -1;
    var items = [];

    window.sncFetch = function(val) {
      var box = document.getElementById('snc-suggestions');
      active = -1;
      if (!val || val.length < 2) { box.style.display='none'; return; }
      clearTimeout(timer);
      timer = setTimeout(function(){
        fetch('https://api.gbif.org/v1/species/suggest?limit=8&q=' + encodeURIComponent(val))
          .then(function(r){ return r.json(); })
          .then(function(data){
            items = data || [];
            box.innerHTML = '';
            if (!items.length) { box.style.display='none'; return; }
            items.forEach(function(sp, i){
              var li = document.createElement('li');
              var sci = sp.canonicalName || sp.scientificName || '';
              var common = (sp.vernacularNames && sp.vernacularNames[0]) ? sp.vernacularNames[0].vernacularName : (sp.vernacularName || '');
              li.style.cssText = 'padding:0.45rem 1rem;cursor:pointer;font-size:0.93rem;line-height:1.35;border-radius:8px;margin:0 0.3rem;';
              li.innerHTML = '<span style="font-style:italic;color:#222;">' + sci + '</span>'
                + (common ? ' <span style="color:#888;font-size:0.85em;">â€” ' + common + '</span>' : '');
              li.onmouseenter = function(){ sncHighlight(i); };
              li.onmouseleave = function(){ sncHighlight(-1); };
              li.onmousedown = function(e){ e.preventDefault(); sncSelect(i); };
              box.appendChild(li);
            });
            box.style.display = 'block';
          })
          .catch(function(){ box.style.display='none'; });
      }, 220);
    };

    window.sncKey = function(e) {
      var box = document.getElementById('snc-suggestions');
      var lis = box.querySelectorAll('li');
      if (e.key === 'ArrowDown')   { e.preventDefault(); sncHighlight(Math.min(active+1, lis.length-1)); }
      else if (e.key === 'ArrowUp') { e.preventDefault(); sncHighlight(Math.max(active-1, -1)); }
      else if (e.key === 'Escape')  { box.style.display='none'; active=-1; }
      else if (e.key === 'Enter' && active >= 0) { e.preventDefault(); sncSelect(active); }
    };

    window.sncHighlight = function(i) {
      var box = document.getElementById('snc-suggestions');
      var lis = box.querySelectorAll('li');
      lis.forEach(function(el, idx){
        el.style.background = idx === i ? '#f0f4ff' : '';
      });
      active = i;
    };

    window.sncSelect = function(i) {
      if (!items[i]) return;
      var name = items[i].canonicalName || items[i].scientificName || '';
      document.getElementById('snc-input').value = name;
      document.getElementById('snc-suggestions').style.display = 'none';
      active = -1;
    };

    document.addEventListener('click', function(e){
      if (!e.target.closest || !e.target.closest('#snc-suggestions') && e.target.id !== 'snc-input') {
        var box = document.getElementById('snc-suggestions');
        if (box) box.style.display='none';
      }
    });
  })();
  </script>
</div>
